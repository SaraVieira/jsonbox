<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Cache-control" content="public" />
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="description" content="Free HTTP based JSON storage" />
	<meta name="keywords" content="json storage, json database, http" />
	<meta property="og:url" content="https://jsonbox.io" />
	<meta property="og:image" content="https://jsonbox.io/icon.png" />
	<meta property="og:title" content="jsonbox.io" />
	<meta property="og:description" content="Free HTTP based JSON storage" />

	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="icon" href="icon.svg" sizes="any" type="image/svg+xml" />
	<title>jsonbox.io | HTTP based JSON storage</title>
	<link href="/style.css" rel="stylesheet" />
</head>

<body>
	<section id="home">
		<div class="wrapper">
			<div id="desc">A dashboard to play around with the data in your box.</div>
			<div id="dashControlsWrap">
				<div id="dashControls">
					<select type="text" class="request-type">
						<option selected value=0>GET</option>
						<option value=1>POST</option>
						<option value=2>PUT</option>
						<option value=3>DELETE</option>
					</select>
					<input type="text" class="mono" id="boxurl" placeholder="Your jsonbox url" />
					<button id="test-box" onclick="sendRequest()">Go</button>
				</div>
			</div>
		</div>
		<div>
			<div id="test-jsonbox">
				<div id="datawrap">
					<div id="inputwrap">
						<p>Your POST/PUT request body:</p>
						<div id="editor"></div>
					</div>
					<div id="outputwrap">
						<p>Output:</p>
						<div id="output"></div>
					</div>
				</div>
			</div>
		</div>
		<div id="nav">
			<a href="/">Back to Home</a>
		</div>
		</div>
	</section>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js"></script>
	<script>
	const qparams = new URLSearchParams(window.location.search)

	const base = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
	if (qparams.get('box')) document.getElementById('boxurl').value = base + "/" + qparams.get('box');

	document.querySelector('#editor, #output').textContent = `{
    "name": "jsonbox.io",
    "desc": "Lorem ipsum dolor sit amet."
}`
	const METHODS = ["GET", "POST", "PUT", "DELETE"] // A dictionary of supported methods

	// setup ace editor
	const editor = ace.edit("editor");
	editor.session.setMode("ace/mode/json"); // editor language
	editor.setTheme("ace/theme/dawn"); // editor theme
	editor.session.setTabSize(4);
	editor.session.setUseWrapMode(true);

	// setup readonly ace editor for output
	const output = ace.edit("output");
	output.session.setMode("ace/mode/json"); // editor language
	output.setTheme("ace/theme/dawn"); // editor theme
	output.session.setTabSize(4);
	output.session.setUseWrapMode(true);
	output.setReadOnly(true);
	output.setHighlightActiveLine(false);
	output.setHighlightGutterLine(false);
	output.renderer.$cursorLayer.element.style.display = 'none';

	const sendRequest = () => {
		try {

			const payload = editor.getValue()
			const type = document.querySelector('.request-type').value
			const box_url = document.querySelector('#boxurl').value

			JSON.parse(payload) // To make sure JSON input is valid else it runs into catch block

			const options = {
				method: METHODS[type],
				body: payload,
				headers: {
					"Content-Type": "application/json",
				},
			}
			// because you can't send a body along with a GET request
			if (type == 0) delete(options.body)

			// Fetch to make API call
			fetch(box_url, options)
				.then(async response => response.json())
				.then(data => {
					output.setValue(JSON.stringify(data, null, 2), 1)
					document.querySelector('.error').style.display = "none"
				})
		} catch (error) {
			console.log(error);
			alert(error.message);
		}
	}

	</script>
</body>

</html>
